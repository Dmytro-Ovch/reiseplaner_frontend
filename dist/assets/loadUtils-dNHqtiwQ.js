import{t as m,l as p}from"./fetchService-m9DKWZIZ.js";import{s as b}from"./associatedFeatureServiceUtils-B9yeEoR3.js";import{ac as h}from"./index-QkvpMIk7.js";class w{constructor(){this._serviceMetadatas=new Map,this._itemDatas=new Map}async fetchServiceMetadata(t,e){const r=this._serviceMetadatas.get(t);if(r)return r;const s=await m(t,e);return this._serviceMetadatas.set(t,s),s}async fetchItemData(t){const{id:e}=t;if(!e)return null;const{_itemDatas:r}=this;if(r.has(e))return r.get(e);const s=await t.fetchData();return r.set(e,s),s}async fetchCustomParameters(t,e){const r=await this.fetchItemData(t);return r&&typeof r=="object"&&(e?e(r):r.customParameters)||null}}function i(a){const t={id:a.id,name:a.name},e=p(a.type);return e!=="FeatureLayer"&&(t.layerType=e),t}async function S(a,t,e){var s,u,c;let r;if((a==null?void 0:a.layers)==null||(a==null?void 0:a.tables)==null){const l=await e.fetchServiceMetadata(t,{customParameters:(s=y(a))==null?void 0:s.customParameters});r=h(),(a=a||{}).layers=a.layers||((u=l==null?void 0:l.layers)==null?void 0:u.map(i)),a.tables=a.tables||((c=l==null?void 0:l.tables)==null?void 0:c.map(i))}return{data:a,preferredHost:r}}function y(a){if(!a)return null;const{layers:t,tables:e}=a;return t!=null&&t.length?t[0]:e!=null&&e.length?e[0]:null}function I(a,t){return t==null?null:[...a.layers||[],...a.tables||[]].find((e=>e.id===t))}function v(a,t){return[...a.layers||[],...a.tables||[]].filter((({layerType:e})=>e?t.includes(e):t.includes("ArcGISFeatureLayer")))}function M(a){var t,e;return(((t=a==null?void 0:a.layers)==null?void 0:t.length)??0)+(((e=a==null?void 0:a.tables)==null?void 0:e.length)??0)}function P(a){switch(a){case"catalog":return["CatalogLayer"];case"feature":return["ArcGISFeatureLayer"];case"oriented-imagery":return["OrientedImageryLayer"];case"subtype-group":return["SubtypeGroupLayer","SubtypeGroupTable"]}return null}function G(a){switch(a){case"CatalogLayer":return"CatalogLayer";case"OrientedImageryLayer":return"OrientedImageryLayer";case"SubtypeGroupLayer":case"SubtypeGroupTable":return"SubtypeGroupLayer"}return"FeatureLayer"}async function D(a,t,e){var u,c,l,f;if(!(a!=null&&a.url))return t??{};if(t??(t={}),!t.layers){const n=await e.fetchServiceMetadata(a.url);t.layers=(u=n.layers)==null?void 0:u.map(i)}const{serverUrl:r,portalItem:s}=await b(a.url,{sceneLayerItem:a,customParameters:(c=y(t))==null?void 0:c.customParameters}).catch((()=>({serverUrl:null,portalItem:null})));if(r==null)return t.tables=[],t;if(!t.tables&&s){const n=await s.fetchData().catch((()=>null));if(n!=null&&n.tables)t.tables=n.tables.map(i);else{const o=await e.fetchServiceMetadata(r,{customParameters:(l=y(n))==null?void 0:l.customParameters}).catch((()=>null));t.tables=(f=o==null?void 0:o.tables)==null?void 0:f.map(i)}}if(t.tables)for(const n of t.tables)n.url=`${r}/${n.id}`;return t}export{i as a,M as c,w as e,G as i,S as l,I as n,P as o,y as s,v as u,D as y};
